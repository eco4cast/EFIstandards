<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example of interacting with and visualizing EFI standard data • EFIstandards</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Example of interacting with and visualizing EFI standard data">
<meta property="og:description" content="EFIstandards">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">EFIstandards</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flare-metadata-example.html">Example metadata for a FLARE forecast</a>
    </li>
    <li>
      <a href="../articles/logistic-metadata-example.html">Example metadata for a Lotka-Volterra population growth forecast</a>
    </li>
    <li>
      <a href="../articles/visualization-example.html">Example of interacting with and visualizing EFI standard data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example of interacting with and visualizing EFI
standard data</h1>
            
      
      
      <div class="hidden name"><code>visualization-example.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/EML/" class="external-link">EML</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/emld/" class="external-link">emld</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">EFIstandards</span><span class="op">)</span></code></pre></div>
<p>Visualizing the simple, example forecast of population growth of two
interacting species</p>
<p>========================================================</p>
<div class="section level2">
<h2 id="parsing-metadata">Parsing metadata<a class="anchor" aria-label="anchor" href="#parsing-metadata"></a>
</h2>
<p>First load the data using <code>EML</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">eml_filename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"forecast-eml.xml"</span>, package<span class="op">=</span><span class="st">"EFIstandards"</span><span class="op">)</span>
<span class="va">md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/read_eml.html" class="external-link">read_eml</a></span><span class="op">(</span><span class="va">eml_filename</span><span class="op">)</span>  <span class="co">#you could replace the variable here with a filename form a downloaded data package from a repository</span></code></pre></div>
<p>Then to examine the details, use <code><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">EML::eml_get</a></code>. First,
the title and abstract and who made it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"title"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## '': A very simple Lotka-Volterra forecast</span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"abstract"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## '': An illustration of how we might use EML metadata to describe an ecological forecast</span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"creator"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## electronicMailAddress: rqthomas@vt.edu</span>
<span class="co">## id: https://orcid.org/0000-0003-1282-7825</span>
<span class="co">## individualName:</span>
<span class="co">##   givenName: Quinn</span>
<span class="co">##   surName: Thomas</span></code></pre>
<p>Then diving in, the coverage and keywords</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"coverage"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## geographicCoverage:</span>
<span class="co">##   geographicDescription: 'Lake Sunapee, NH, USA '</span>
<span class="co">##   boundingCoordinates:</span>
<span class="co">##     westBoundingCoordinate: '-72.15'</span>
<span class="co">##     eastBoundingCoordinate: '-72.05'</span>
<span class="co">##     northBoundingCoordinate: '43.48'</span>
<span class="co">##     southBoundingCoordinate: '43.36'</span>
<span class="co">## taxonomicCoverage:</span>
<span class="co">##   taxonomicClassification:</span>
<span class="co">##   - taxonRankName: Genus</span>
<span class="co">##     taxonRankValue: Gloeotrichia</span>
<span class="co">##     taxonomicClassification:</span>
<span class="co">##       taxonRankName: Species</span>
<span class="co">##       taxonRankValue: echinulata</span>
<span class="co">##   - taxonRankName: Genus</span>
<span class="co">##     taxonRankValue: Anabaena</span>
<span class="co">##     taxonomicClassification:</span>
<span class="co">##       taxonRankName: Species</span>
<span class="co">##       taxonRankValue: circinalis</span>
<span class="co">## temporalCoverage:</span>
<span class="co">##   rangeOfDates:</span>
<span class="co">##     beginDate:</span>
<span class="co">##       calendarDate: '2001-03-04'</span>
<span class="co">##     endDate:</span>
<span class="co">##       calendarDate: '2001-04-02'</span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"keywordSet"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## keyword:</span>
<span class="co">## - forecast</span>
<span class="co">## - population</span>
<span class="co">## - timeseries</span>
<span class="co">## keywordThesaurus: EFI controlled vocabulary</span></code></pre>
<p>Looks like it’s a population level timeseries forecast of Lake
Sunapee, NH, USA for two species:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># these seem a bit of a pain to pull out maybe there's an easier way</span>
<span class="va">spps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"taxonRankValue"</span><span class="op">)</span>
<span class="va">sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">spps</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span>
<span class="va">sp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">spps</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, collapse<span class="op">=</span><span class="st">" "</span><span class="op">)</span>
<span class="va">sp1</span></code></pre></div>
<pre><code><span class="co">## [1] "Gloeotrichia echinulata"</span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sp2</span></code></pre></div>
<pre><code><span class="co">## [1] "Anabaena circinalis"</span></code></pre>
</div>
<div class="section level2">
<h2 id="reading-structured-methods">Reading structured methods<a class="anchor" aria-label="anchor" href="#reading-structured-methods"></a>
</h2>
<p>Load the additional metadata (see documentation of EFI forecasting
standard):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">methods_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"additionalMetadata"</span><span class="op">)</span>
<span class="va">methods_md</span></code></pre></div>
<pre><code><span class="co">## metadata:</span>
<span class="co">##   forecast:</span>
<span class="co">##     drivers:</span>
<span class="co">##       status: absent</span>
<span class="co">##     forecast_horizon: 30 days</span>
<span class="co">##     forecast_issue_time: '2001-03-04'</span>
<span class="co">##     forecast_iteration_id: 20010304T060000</span>
<span class="co">##     forecast_project_id: LogisticDemo</span>
<span class="co">##     initial_conditions:</span>
<span class="co">##       complexity: '2'</span>
<span class="co">##       status: present</span>
<span class="co">##     metadata_standard_version: '0.3'</span>
<span class="co">##     model_description:</span>
<span class="co">##       forecast_model_id: v0.3</span>
<span class="co">##       name: discrete Lotka–Volterra model</span>
<span class="co">##       repository: https://github.com/eco4cast/EFIstandards/blob/master/vignettes/logistic-metadata-example.Rmd</span>
<span class="co">##       type: process-based</span>
<span class="co">##     obs_error:</span>
<span class="co">##       complexity: '2'</span>
<span class="co">##       covariance: 'FALSE'</span>
<span class="co">##       status: present</span>
<span class="co">##     parameters:</span>
<span class="co">##       complexity: '6'</span>
<span class="co">##       status: present</span>
<span class="co">##     process_error:</span>
<span class="co">##       complexity: '2'</span>
<span class="co">##       covariance: 'FALSE'</span>
<span class="co">##       propagation:</span>
<span class="co">##         size: '10'</span>
<span class="co">##         type: ensemble</span>
<span class="co">##       status: propagates</span>
<span class="co">##     random_effects:</span>
<span class="co">##       status: absent</span>
<span class="co">##     timestep: 1 day</span></code></pre>
<p>This metadata contains details about the system forecast including
number of state variables and parameters, and the methods used,
including propagation of uncertainty. For example, details of the
treatment of process error in this model are given by</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">methods_md</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="st">"process_error"</span><span class="op">)</span> <span class="co"># note could do this directly on \`md` object</span></code></pre></div>
<pre><code><span class="co">## complexity: '2'</span>
<span class="co">## covariance: 'FALSE'</span>
<span class="co">## propagation:</span>
<span class="co">##   size: '10'</span>
<span class="co">##   type: ensemble</span>
<span class="co">## status: propagates</span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">n_ensembles</span> <span class="op">&lt;-</span> <span class="va">methods_md</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="st">"process_error"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="st">"size"</span><span class="op">)</span>
<span class="va">n_ensembles</span> <span class="op">&lt;-</span> <span class="va">n_ensembles</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>From this metadata, the output of this forecast should have error
propagation via an ensemble of size 10, process error for two state
varible dimensions with no covariance between these. Further, one can
check if the forecast used data assimilation (no):</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"assimilation"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## {}</span></code></pre>
</div>
<div class="section level2">
<h2 id="output-metadata">Output metadata<a class="anchor" aria-label="anchor" href="#output-metadata"></a>
</h2>
<p>Finally, I’ll dive into the metadata for the output data itself.
Wait, which output data? All we’ve seen so far is metadata!</p>
<p>First remember that EML specifies a tag “physical” for the location
of an actual data file. There’s plenty of metadata on the file itself
including authentication format, etc</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_md</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"dataset"</span><span class="op">)</span>
<span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">dt_md</span>, <span class="st">"physical"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## authentication:</span>
<span class="co">##   method: MD5</span>
<span class="co">##   authentication: 4dbe687fa1f5fc0ff789096076eebd78</span>
<span class="co">## dataFormat:</span>
<span class="co">##   textFormat:</span>
<span class="co">##     recordDelimiter: |2+</span>
<span class="co">## </span>
<span class="co">##     attributeOrientation: column</span>
<span class="co">##     simpleDelimited:</span>
<span class="co">##       fieldDelimiter: ','</span>
<span class="co">## objectName: logistic-forecast-ensemble-multi-variable-multi-depth.csv</span>
<span class="co">## size:</span>
<span class="co">##   unit: bytes</span>
<span class="co">##   size: '110780'</span></code></pre>
<p>To get the data parse the filename and load it!</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">datafilename</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">dt_md</span>, <span class="st">"objectName"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="co"># this steps are necessary because this is in an R package if you have a downloaded data repository</span>
<span class="co"># you coudl just pass 'datafilename' into read.csv here</span>
<span class="va">datafile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="va">datafilename</span>, package<span class="op">=</span><span class="st">"EFIstandards"</span><span class="op">)</span> 
<span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">datafile</span>, row.names<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">dt</span></code></pre></div>
<pre><code><span class="co">## <span style="color: #949494;"># A tibble: 1,800 × 8</span></span>
<span class="co">##    time    depth ensemble obs_flag species_1 species_2 forecast data_assimilati…</span>
<span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">## <span style="color: #BCBCBC;"> 1</span> 2001-0…     1        1        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;"> 2</span> 2001-0…     3        1        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;"> 3</span> 2001-0…     5        1        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;"> 4</span> 2001-0…     1        2        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;"> 5</span> 2001-0…     3        2        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;"> 6</span> 2001-0…     5        2        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;"> 7</span> 2001-0…     1        3        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;"> 8</span> 2001-0…     3        3        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;"> 9</span> 2001-0…     5        3        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #BCBCBC;">10</span> 2001-0…     1        4        1       0.5       0.5        0                0</span>
<span class="co">## <span style="color: #949494;"># … with 1,790 more rows</span></span></code></pre>
<p>OK! This has the column names and actual data. To understand these
column names, recall the output dataset metadata, which was loaded
earlier. In particular the <code>attributeList</code> contains fine
details like units and definitions for each column:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_md_cols</span> <span class="op">&lt;-</span> <span class="va">dt_md</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="st">"attributeList"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://docs.ropensci.org/EML/reference/get_attributes.html" class="external-link">get_attributes</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">dt_md_cols</span><span class="op">$</span><span class="va">attributes</span></code></pre></div>
<pre><code><span class="co">##       attributeName                        attributeDefinition storageType</span>
<span class="co">## 1              time                          [dimension]{time}        date</span>
<span class="co">## 2             depth            [dimension]{depth in reservior}       float</span>
<span class="co">## 3          ensemble      [dimension]{index of ensemble member}       float</span>
<span class="co">## 4          obs_flag             [dimension]{observation error}       float</span>
<span class="co">## 5         species_1      [variable]{Pop. density of species 1}       float</span>
<span class="co">## 6         species_2      [variable]{Pop. density of species 2}       float</span>
<span class="co">## 7          forecast [flag]{whether time step assimilated data}       float</span>
<span class="co">## 8 data_assimilation [flag]{whether time step assimilated data}       float</span>
<span class="co">##   formatString measurementScale         domain                  unit numberType</span>
<span class="co">## 1   YYYY-MM-DD         dateTime dateTimeDomain                  &lt;NA&gt;       &lt;NA&gt;</span>
<span class="co">## 2         &lt;NA&gt;            ratio  numericDomain                 meter       real</span>
<span class="co">## 3         &lt;NA&gt;            ratio  numericDomain         dimensionless    integer</span>
<span class="co">## 4         &lt;NA&gt;            ratio  numericDomain         dimensionless    integer</span>
<span class="co">## 5         &lt;NA&gt;            ratio  numericDomain numberPerMeterSquared       real</span>
<span class="co">## 6         &lt;NA&gt;            ratio  numericDomain numberPerMeterSquared       real</span>
<span class="co">## 7         &lt;NA&gt;            ratio  numericDomain         dimensionless    integer</span>
<span class="co">## 8         &lt;NA&gt;            ratio  numericDomain         dimensionless    integer</span></code></pre>
<p>Cross-referencing this documentation of EFI forecasting standards,
note that <code>data_assimilation</code> column is zeroed out so this
performed no data assimilation and <code>forecast</code> column is
zeroed out so this was a hindcast. As expected, there are 10 ensemble
members in the forecast. As consumer of this type of forecast this is
the only way to understand the uncertainty in the forecast.</p>
</div>
<div class="section level2">
<h2 id="visualizing-the-data">Visualizing the data<a class="anchor" aria-label="anchor" href="#visualizing-the-data"></a>
</h2>
<p>The output includes densities (number per meter squared) for both
species 1 and species 2. I assume these are in the same order as the
entries in <code>taxononmicCoverage</code>: Gloeotrichia echinulata and
Anabaena circinalis at several depths measured in meters. Glancing at
column <code>depth</code> there are only three depths represented. While
reshaping the data, I will rename columns with useful information about
their units and construct a categorical variable with the actual species
names:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dtl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="va">dt</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species_1"</span>, <span class="st">"species_2"</span><span class="op">)</span>, values_to<span class="op">=</span><span class="st">"density (m^-2)"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,
         name<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">name</span>, species_1<span class="op">=</span><span class="va">sp1</span>, species_2<span class="op">=</span><span class="va">sp2</span><span class="op">)</span>,
         `depth (m)` <span class="op">=</span> <span class="va">depth</span><span class="op">)</span></code></pre></div>
<p>Given the ensembles, order statitics or quantiles seem like a natural
choice to summarize uncertainty, so compute the median and upper and
lower quartiles:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dtl</span> <span class="op">&lt;-</span> <span class="va">dtl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">depth</span>, <span class="va">time</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>density_50 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">`density (m^-2)`</span><span class="op">)</span>,
         density_25 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">`density (m^-2)`</span>, <span class="fl">.25</span><span class="op">)</span>,
         density_75 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">`density (m^-2)`</span>, <span class="fl">.75</span><span class="op">)</span>
         <span class="op">)</span></code></pre></div>
<p>Putting these pieces together to visualize and describe the forecast
and its uncertainty:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dtl</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, ymin<span class="op">=</span><span class="va">density_25</span>, ymax<span class="op">=</span><span class="va">density_75</span>, fill<span class="op">=</span><span class="va">name</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">`density (m^-2)`</span>, color<span class="op">=</span><span class="va">name</span>, group<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">ensemble</span><span class="op">)</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="co">#geom_smooth(aes(group=name), method='gam', formula= y ~ s(x, bs = "cs", k=30)) + </span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">density_50</span>, color<span class="op">=</span><span class="va">name</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">`depth (m)`</span> <span class="op">~</span> <span class="va">.</span>, labeller<span class="op">=</span><span class="va">label_both</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">'Median density'</span><span class="op">)</span>,
         fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">'25th-75th quantile density'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title<span class="op">=</span><span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">'title'</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
       subtitle<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Forecast from"</span>, <span class="va">n_ensembles</span>, <span class="st">"ensembles (thin lines), with uncertainty from quantiles."</span><span class="op">)</span>,
       caption<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Demo visualization from EFIstandards package for an \nimaginary forecast at"</span>, <span class="fu"><a href="https://docs.ropensci.org/EML/reference/eml_get.html" class="external-link">eml_get</a></span><span class="op">(</span><span class="va">md</span>, <span class="st">"geographicDescription"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="visualization-example_files/figure-html/unnamed-chunk-2-1.png" alt="Forecast density of two interacting species at several depths with uncertainty." width="700"><p class="caption">
Forecast density of two interacting species at several depths with
uncertainty.
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Carl Boettiger, Quinn Thomas, Michael Dietze, Alexey Shiklomanov, Jaime Ashander.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
